Backbone.Cloudant=_.clone(Backbone.Events),_.extend(Backbone.Cloudant,{VERSION:"0.0.1",database:"http://username.cloudant.com/mydb",auth:{},watch:function(a){this.on("change:cloudant_change",function(b){a.handleChange(b)})},changeHandler:function(a){function c(){b.changeHandler(a)}var b=this;a=a||0,$.getJSON(b.database+"/_changes",{since:a,feed:"longpoll"}).success(function(d){a!==d.last_seq&&(a=d.last_seq,b.trigger("change:cloudant_change",d.results)),c()}).error(function(a){setTimeout(c,5e3)})}}),Backbone.Cloudant.Model=Backbone.Model.extend({idAttribute:"_id",url:function(){var a=Backbone.Cloudant.database;return typeof this.id!="undefined"&&(a+="/"+this.id),a},parse:function(a){return a.rev&&(a._rev=a.rev,delete a.rev),a.id&&(typeof this.id=="undefined"&&(a._id=a.id),delete a.id),a.ok&&delete a.ok,a}}),Backbone.Cloudant.Collection=Backbone.Collection.extend({model:Backbone.Cloudant.Model,cloudant_options:{},totalLength:0,initialize:function(a){a&&a.watch&&(Backbone.Cloudant.watch(this),delete a.watch)},parse:function(a){return a.total_rows?this.totalLength=a.total_rows:this.totalLength=a.rows.length,a.rows},fetchMore:function(){this.cloudant_options.limit&&(this.cloudant_options.skip?this.cloudant_options.skip+=this.cloudant_options.limit:this.cloudant_options.skip=this.cloudant_options.limit,this.fetch({add:!0}))},baseURL:function(){return Backbone.Cloudant.database},url:function(){var a=$.param(this.cloudant_options),b=this.baseURL();return a&&(b=b+"?"+a),b},handleChange:function(a){this.fetch()}}),Backbone.Cloudant.Docs={Collection:Backbone.Cloudant.Collection.extend({baseURL:function(){return[Backbone.Cloudant.database,"_all_docs"].join("/")}})},Backbone.Cloudant.Search={Collection:Backbone.Cloudant.Collection.extend({design:"my_design",index:"my_index",parse:function(a){return this.cloudant_options.bookmark=a.bookmark,a.total_rows?this.totalLength=a.total_rows:this.totalLength=a.rows.length,a.rows},baseURL:function(){return[Backbone.Cloudant.database,"_design",this.design,"_search",this.index].join("/")},fetchMore:function(){this.fetch({add:!0})}})},Backbone.Cloudant.View={Collection:Backbone.Cloudant.Collection.extend({design:"my_design",view:"my_view",baseURL:function(){return[Backbone.Cloudant.database,"_design",this.design,"_view",this.view].join("/")}})};