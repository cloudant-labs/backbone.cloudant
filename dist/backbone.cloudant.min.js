Backbone.Cloudant=_.clone(Backbone.Events),_.extend(Backbone.Cloudant,{VERSION:"0.0.2",database:"http://username.cloudant.com/mydb",auth:{},watch:function(a){this.on("change:cloudant_change",function(b){a.handleChange(b)})},changeHandler:function(a){function b(){c.changeHandler(a)}var c=this;a=a||0,$.getJSON(c.database+"/_changes",{since:a,feed:"longpoll"}).success(function(d){a!==d.last_seq&&(a=d.last_seq,c.trigger("change:cloudant_change",d.results)),b()}).error(function(){setTimeout(b,5e3)})}}),Backbone.Cloudant.Model=Backbone.Model.extend({idAttribute:"_id",url:function(){var a=Backbone.Cloudant.database;return"undefined"!=typeof this.id&&(a+="/"+this.id),a},parse:function(a){return a.rev&&(a._rev=a.rev,delete a.rev),a.id&&("undefined"==typeof this.id&&(a._id=a.id),delete a.id),a.ok&&delete a.ok,a},destroy:function(a){var b={url:this.url()+"?"+$.param({rev:this.get("_rev")})};a=_.extend(b,a),Backbone.Model.prototype.destroy.apply(this,[a])}}),Backbone.Cloudant.Collection=Backbone.Collection.extend({model:Backbone.Cloudant.Model,cloudant_options:{},totalLength:0,initialize:function(a){a&&a.watch&&(Backbone.Cloudant.watch(this),delete a.watch)},parse:function(a){return this.totalLength=a.total_rows?a.total_rows:a.rows.length,a.rows},fetchMore:function(){this.cloudant_options.limit&&(this.cloudant_options.skip?this.cloudant_options.skip+=this.cloudant_options.limit:this.cloudant_options.skip=this.cloudant_options.limit,this.fetch({add:!0}))},baseURL:function(){return Backbone.Cloudant.database},url:function(){var a=$.param(this.cloudant_options),b=this.baseURL();return a&&(b=b+"?"+a),b},handleChange:function(){this.fetch()}}),Backbone.Cloudant.Docs={Collection:Backbone.Cloudant.Collection.extend({baseURL:function(){return[Backbone.Cloudant.database,"_all_docs"].join("/")}})},Backbone.Cloudant.Index=Backbone.Cloudant.Collection.extend({design:"my_design",view:"my_view",baseURL:function(){return[Backbone.Cloudant.database,"_design",this.design,"_view",this.view].join("/")}}),Backbone.Cloudant.Search=Backbone.Cloudant.Index.extend({design:"my_design",index:"my_index",parse:function(a){return this.cloudant_options.bookmark=a.bookmark,this.totalLength=a.total_rows?a.total_rows:a.rows.length,a.rows},baseURL:function(){return[Backbone.Cloudant.database,"_design",this.design,"_search",this.index].join("/")},fetchMore:function(){this.fetch({add:!0})}});